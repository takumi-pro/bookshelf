# 安全なWebアプリケーションの作り方

## 1. Webアプリケーションの脆弱性とは
- セキュリティバグとセキュリティ機能は異なる
- セキュリティガイドライン
  - [安全なウェブサイトの作り方](https://www.ipa.go.jp/security/vuln/websecurity/about.html)
  - OWASP Top 10

## 2. 実習環境のセットアップ
- 環境
  - Linux(Debian 9)
  - nginx 1.10
  - Apache 2.4
  - PHP 5.3 / PHP 7.0
  - Tomcat 8.5
  - MariaDB 10.1
  - Postfix 3.1

Dockerを用いて環境を作成していく。
[このページ](https://wasbook.org/wasbook-docker.html)を参考にした。
`docker compose up -d`で起動できたら`127.0.0.1:13128`にアクセスすることで各章で検証するページを確認できる。

### OWASP ZAPインストール
- Webアプリケーション脆弱性診断用ツール
- MAC上でプロキシとして動作する
- [ダウンロードサイト](https://www.zaproxy.org/download/)でダウンロード
- Manual Exploreでブラウザを起動を選択し、対象となるURLを入力しサイトに遷移する

## 3. Webセキュリティの基礎
- ブラウザから送信する値は利用者が書き換え可能
- hiddenパラメータは利用者自身により書き換えが可能
  - 情報漏洩や第三者からの書き換えに対しては堅牢
- cookieでセッション管理を実現する
- 開発ツールの提供するセッション管理機構を利用する
- cookieのセキュリティ上重要な属性は`Domain`, `Secure`, `HttpOnly`
  - Domainはデフォルトの状態が最も送信範囲が狭いため、設定しない
  - SecureはHTTPSの場合のみcookieを送信する
  - HttpOnlyが指定されたcookieはJavaScriptからアクセスできない

### 受動的攻撃と同一オリジンポリシー
- webアプリケーションの攻撃は能動的攻撃、受動的攻撃に分けられる
- サンドボックスを用いてプログラムができることに制限を設けることでセキュリティを強化している
  - ローカルファイルへのアクセスの禁止
  - 資源の利用禁止
  - ネットワークアクセスの制限(同一オリジンポリシー)
- ブラウザは一度に複数サイトのオブジェクトを扱うことができる
  - タブやframeなど
- サイト間でのアクセスを禁止するのが同一オリジンポリシー

### CORS
- 異なるオリジンとのデータ交換を可能にする
- シンプルなリクエストの場合は許可なしにHTTPリクエストを送ることができる

